# day10-uni-appé¡¹ç›®

## 01.è´­ç‰©è½¦é¡µâ€”é€‰ä¸­å•†å“ç»Ÿè®¡
### ç›®æ ‡
æŒæ¡åŸºäºgetterså»åˆ›å»ºgetters
### æ ¸å¿ƒæ­¥éª¤

1. åˆ›å»ºä¸€ä¸ª**getters**ä»£è¡¨å½“å‰é€‰ä¸­çš„å•†å“
2. åŸºäºé€‰ä¸­å•†å“çš„**getters**è®¡ç®—å‡ºé€‰ä¸­å•†å“çš„**æ€»æ•°é‡**å’Œ**æ€»ä»·æ ¼**
3. åœ¨é¡µé¢ä¸­åˆ›å»ºå¯¹åº”çš„è®¡ç®—å±æ€§æ‰¿æ¥å¯¹åº”çš„getters
```javascript
getters: {
    isAllSelected(state) {
      return state.cartList.every(v => v.goods_select);
    },
    // é€‰ä¸­çš„å•†å“
    selectedCartList(state) {
      return state.cartList.filter(v => v.goods_select);
    },
    // é€‰ä¸­å•†å“çš„æ€»æ•°é‡
    selectedCartListCount(state, getters) {
      // forEachå®ç°æ–¹å¼  å®¹æ˜“ç†è§£
      // let sum = 0;
      // getters.selectedCartList.forEach(item => {
      //   sum += item.goods_count;
      // })
      // return sum;

      // reduceçš„å®ç°æ–¹å¼
      return getters.selectedCartList.reduce((sum, item) => {
        return sum += item.goods_count;
      }, 0);
    },

    // é€‰ä¸­å•†å“çš„æ€»ä»·æ ¼
    selectedCartListPrice(state, getters) {
      // forEachå®ç°æ–¹å¼  å®¹æ˜“ç†è§£
      // let sum = 0;
      // getters.selectedCartList.forEach(item => {
      //   sum += item.goods_count * item.goods_price;
      // })
      // return sum;

      // reduceçš„å®ç°æ–¹å¼
      return getters.selectedCartList.reduce((sum, item) => {
        return sum += item.goods_count * item.goods_price;
      }, 0);
    },
  },
```

```vue

 computed: {
    cartList: JSON.parse(JSON.stringify(this.$store.state.cartList)),
    ...mapGetters(['isAllSelected', 'selectedCartListCount', 'selectedCartListPrice']),
  },
```
## 02.è´­ç‰©è½¦é¡µâ€”ç©ºçŠ¶æ€å±•ç¤º
### ç›®æ ‡
ç†Ÿç»ƒæŒæ¡u-emptyç»„ä»¶çš„ä½¿ç”¨
### å‚è€ƒä»£ç 
```vue
<u-empty mode="car" v-if="!cartList.length">
  <navigator
          	url="/pages/index/index"
             open-type="switchTab"
             hover-class="none"
             >
    <u-button type="primary">å»é€›é€›å§~</u-button>
  </navigator>
</u-empty>
```

## 03.æ”¯ä»˜ç»“ç®—é¡µâ€”è·³è½¬åŠé¡µé¢æ¸²æŸ“
### ç›®æ ‡
å®Œæˆæ”¯ä»˜é¡µçš„åˆ›å»ºåŠè·³è½¬
### æ ¸å¿ƒæ­¥éª¤

1. ç»™ç»“ç®—æŒ‰é’®ç»‘å®šäº‹ä»¶
2. åˆ¤æ–­æœ‰æ— é€‰ä¸­å•†å“ 
   - æœ‰ï¼Œè·³è½¬é¡µé¢
   - æ²¡æœ‰ï¼Œæç¤ºé€‰æ‹©å•†å“
3. æ­å»ºé¡µé¢é™æ€ç»“æ„
4. åœ¨é¡µé¢ä¸­å£°æ˜å¯¹åº”çš„è®¡ç®—å±æ€§æ‰¿æ¥å¯¹åº”çš„getterså®Œæˆæ¸²æŸ“
```vue
<!-- ç»“ç®— -->
<view @click="gotoPay" class="account">å»ç»“ç®—({{ selectedCartListCount }})</view>

<script>
 // è·³è½¬æ”¯ä»˜é¡µ
    gotoPay() {
      if (this.selectedCartListCount) {
				uni.navigateTo({
          url: '/pages/pay/index'
        });
      } else {
				return uni.showToast({
          icon: 'error',
          title: 'è¯·é€‰æ‹©å•†å“',
          mask: true
        });
			}
    }
</script>
```
**ç»“ç®—é¡µé¢é™æ€ç»“æ„å‚è€ƒä»£ç **

```vue
<template>
  <view>
    <!-- æ¨¡å—1ï¼šæ”¶è´§åœ°å€ -->
    <view class="address">
      <!-- æ­£å¸¸æƒ…å†µï¼šæ˜¾ç¤ºæ”¶è´§åœ°å€ -->
      <view v-if="true" class="address-info">
        <view class="address-detail">{{ 'ç”¨æˆ·æ”¶è´§åœ°å€' }}</view>
        <view class="address-user"> {{ 'æ”¶è´§äºº' }} {{ '135****7057' }} </view>
      </view>
      <!-- äº’æ–¥æƒ…å†µï¼šæ˜¾ç¤ºæ·»åŠ æŒ‰é’® -->
      <view v-else class="address-btn">æ·»åŠ åœ°å€</view>
    </view>
    <!-- æ¨¡å—2ï¼šå·²é€‰å•†å“åˆ—è¡¨ -->
    <view class="goods-list">
      <view class="goods-title">å·²é€‰å•†å“</view>
      <view class="cart-item" v-for="item in 5" :key="item">
        <view class="cart-count"> x{{ 100 }} </view>
        <navigator
          class="goods-item"
          hover-class="none"
          :url="`/pages/index/index`"
        >
          <!-- å•†å“å›¾ç‰‡ -->
          <image
            class="goods-image"
            :src="`http://image1.suning.cn/uimg/b2c/newcatentries/0070086431-000000000613789336_1_400x400.jpg`"
            mode="aspectFit"
          />
          <!-- å•†å“ä¿¡æ¯ -->
          <view class="goods-info">
            <view class="goods-name">{{ 'å•†å“åç§°' }}</view>
            <view class="goods-price">{{ 'å•†å“ä»·æ ¼' }}</view>
          </view>
        </navigator>
      </view>
    </view>
    <!-- æ¨¡å—3ï¼šåº•éƒ¨æ“ä½œæ  -->
    <view class="bottom-bar">
      <view class="bottom-bar-fixed">
        <!-- åˆè®¡ -->
        <view class="total">
          <text class="total-name">åˆè®¡ï¼š</text>
          <text class="total-price">{{ 'åˆè®¡é’±æ•°' }}</text>
        </view>
        <!-- ç»“ç®— -->
        <view class="account"> å»æ”¯ä»˜({{ 'æ•°é‡' }}) </view>
      </view>
    </view>
  </view>
</template>

<script>
export default {
  data() {
    return {
      //
    }
  },
}
</script>

<style lang="scss">
page {
  background-color: #f4f4f4;
}
// æ¨¡å—1ï¼šæ”¶è´§åœ°å€
.address {
  background-color: #fff;
  margin: 20rpx;
  padding: 20rpx;
  border-radius: 10rpx;
  display: flex;
  justify-content: center;
  align-items: center;
  .address-info {
    width: 100%;
    .address-detail {
      font-size: 30rpx;
      font-weight: bold;
      margin-bottom: 20rpx;
    }
  }
  .address-btn {
    width: 303rpx;
    height: 90rpx;
    border-radius: 45rpx;
    display: flex;
    justify-content: center;
    align-items: center;
    border: 1px solid #eb4450;
    color: #eb4450;
  }
}

// æ¨¡å—2ï¼šå·²é€‰å•†å“åˆ—è¡¨
.goods-list {
  background-color: #fff;
  margin: 20rpx;
  padding: 20rpx;
  border-radius: 10rpx;
  .goods-title {
    line-height: 40rpx;
    font-size: 26rpx;
  }
  .cart-item {
    position: relative;
    .cart-count {
      position: absolute;
      right: 20rpx;
      bottom: 30rpx;
    }
    // é€‰ä¸­æœ€åä¸€é¡¹
    &:last-child {
      .goods-item {
        border: none;
      }
    }
  }
}
// å…¨å±€å…¬å…±æ ·å¼
.goods-list {
  .goods-item {
    display: flex;
    border-bottom: 1rpx solid #ddd;
    padding: 25rpx;
    .goods-image {
      width: 190rpx;
      height: 190rpx;
    }
    .goods-info {
      flex: 1;
      font-size: 24rpx;
      // å‚ç›´æ–¹å‘ä¸¤ç«¯å¯¹é½
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 20rpx;
      .goods-name {
        // å¤šè¡Œè¶…å‡ºéšè—
        overflow: hidden;
        -webkit-line-clamp: 2;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-box-orient: vertical;
      }
      .goods-price {
        color: #eb4450;
        // å‰é¢çš„ä»·æ ¼ç¬¦å·
        &::before {
          content: 'ï¿¥';
          font-size: 80%;
          margin-right: 5rpx;
        }
      }
    }
  }
}

// åº•éƒ¨æ“ä½œæ 
.bottom-bar {
  // å ä½ç”¨
  height: 100rpx;
  // å®šä½çš„æ“ä½œæ 
  .bottom-bar-fixed {
    height: 80rpx;
    position: fixed;
    z-index: 99;
    left: 0;
    right: 0;
    bottom: 0;

    border-top: 1px solid #eee;
    background-color: #fff;
    display: flex;
    align-items: center;
    padding: 0 20rpx;

    .select {
      .select-radio {
        font-size: 24rpx;
        color: #999;
      }
    }

    .total {
      flex: 1;
      display: flex;
      align-items: center;
      margin-left: 40rpx;
      .total-name {
        font-size: 24rpx;
      }

      .total-price {
        color: #eb4450;
      }
    }

    .account {
      background-color: #eb4450;
      color: #fff;
      font-size: 22rpx;
      width: 150rpx;
      height: 52rpx;
      border-radius: 26rpx;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  }
}
</style>
```



### å·²é€‰å•†å“çš„vuexæ•°æ®åŠ¨æ€æ¸²æŸ“

```vue
<!-- æ¨¡å—2ï¼šå·²é€‰å•†å“åˆ—è¡¨ -->
    <view class="goods-list">
      <view class="goods-title">å·²é€‰å•†å“</view>
      <view class="cart-item" v-for="item in selectedCartList" :key="item.goods_id">
        <view class="cart-count"> x{{ item.goods_count }} </view>
        <navigator
          class="goods-item"
          hover-class="none"
          :url="`/pages/goods_detail/goods_detail?goods_id=${item.goods_id}`"
        >
          <!-- å•†å“å›¾ç‰‡ -->
          <image
            class="goods-image"
            :src="item.goods_small_logo"
            mode="aspectFit"
          />
          <!-- å•†å“ä¿¡æ¯ -->
          <view class="goods-info">
            <view class="goods-name">{{ item.goods_name }}</view>
            <view class="goods-price">{{ item.goods_price }}</view>
          </view>
        </navigator>
      </view>
    </view>
    <!-- æ¨¡å—3ï¼šåº•éƒ¨æ“ä½œæ  -->
    <view class="bottom-bar">
      <view class="bottom-bar-fixed">
        <!-- åˆè®¡ -->
        <view class="total">
          <text class="total-name">åˆè®¡ï¼š</text>
          <text class="total-price">{{ selectedCartListPrice }}</text>
        </view>
        <!-- ç»“ç®— -->
        <view class="account"> å»æ”¯ä»˜({{ selectedCartListCount }}) </view>
      </view>
    </view>
    
    
   computed: {
    ...mapGetters(['selectedCartList', 'selectedCartListCount', 'selectedCartListPrice'])
  }
```

## 04.æ”¯ä»˜ç»“ç®—é¡µâ€”è·å–å¾®ä¿¡æ”¶è´§åœ°å€
### ç›®æ ‡
ç†Ÿç»ƒæŒæ¡å°ç¨‹åºä¸­è·å–æ”¶è´§åœ°å€çš„ä½¿ç”¨æ–¹å¼
### èƒŒæ™¯çŸ¥è¯†
**wx.chooseAddressç®€ä»‹**

-  ç”±äºå°ç¨‹åºæ˜¯è¿è¡Œåœ¨å¾®ä¿¡ä¸Šçš„ä¸€ä¸ªç¨‹åºï¼Œå› æ­¤å¯ä»¥è·å–å¾®ä¿¡çš„æ”¶è´§åœ°å€ï¼Œæ‰€æœ‰å¾®ä¿¡å°ç¨‹åºéƒ½èƒ½è°ƒç”¨ã€‚ 
-  è‡ª 2022 å¹´ 7 æœˆ 14 æ—¥åå‘å¸ƒçš„å°ç¨‹åºï¼Œè‹¥ä½¿ç”¨è¯¥æ¥å£ï¼Œéœ€è¦åœ¨ app.json ä¸­è¿›è¡Œå£°æ˜ 
   -  åŸç”Ÿå°ç¨‹åºå£°æ˜æ–¹å¼ï¼Œapp.jsonä¸­ 
```json
"tabBar": {
},
"requiredPrivateInfos": [
  "chooseAddress"
],
```

   -  uni-appå£°æ˜æ–¹å¼ï¼Œmainfest.jsonä¸­ 
```json
"mp-weixin": {
  "appid": "xxxx",
  "setting": {
    "urlCheck": false
  },
  "requiredPrivateInfos": [
    "chooseAddress"
  ],
  "usingComponents": true
},
```
 <br />**æ‰‹æœºä¸Šæ•ˆæœ**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/32808751/1677206764985-ca349dee-ee75-4b2a-90e5-c135fc0a5f35.png#averageHue=%23faf9f6&clientId=u1af59fa0-e68f-4&from=paste&height=622&id=u8de43d46&name=image.png&originHeight=1244&originWidth=1750&originalType=binary&ratio=2&rotation=0&showTitle=false&size=761671&status=done&style=none&taskId=u2dc35c37-4e6a-4ac1-8fe0-1850c9597d6&title=&width=875)

### æ ¸å¿ƒæ­¥éª¤

1.  å®Œæˆæƒé™é…ç½® 
2.  åˆ¤æ–­æ˜¯å¦å·²è·å–äº†åœ°å€ 
   - æ˜¯ **æ˜¾ç¤ºå·²æœ‰åœ°å€**
   - å¦ 
      - ç»‘å®šäº‹ä»¶è°ƒç”¨wx.chooseAddressè·å–æ”¶è·åœ°å€
```vue
 <!-- æ¨¡å—1ï¼šæ”¶è´§åœ°å€ -->
    <view class="address">
      <!-- æ­£å¸¸æƒ…å†µï¼šæ˜¾ç¤ºæ”¶è´§åœ°å€ -->
      <view v-if="address.userName" class="address-info">
        <view class="address-detail">{{ detailAddress }}</view>
        <view class="address-user"> {{ address.userName }} {{ address.telNumber }} </view>
      </view>
      <!-- äº’æ–¥æƒ…å†µï¼šæ˜¾ç¤ºæ·»åŠ æŒ‰é’® -->
      <view @click="getAddress" v-else class="address-btn">æ·»åŠ åœ°å€</view>
    </view>
<script>    
export default {
  data() {
    return {
      address: {}
    }
  },
  computed: {
    detailAddress() {
      const {cityName, countyName, detailInfo, provinceName } = this.address;
      return [provinceName, cityName, countyName, detailInfo].join(' ');
    },  
    ...mapGetters(['selectedCartList', 'selectedCartListCount', 'selectedCartListPrice'])
  },
  methods: {
    // è·å–æ”¶è·åœ°å€
    async getAddress() {
      const [error,res] = await uni.chooseAddress();
      // console.log(res);
      this.address = res;
    }
  }
}
</script>
```
## 05.ä¸ªäººä¸­å¿ƒâ€”é¡µé¢æ­å»ºåŠè·å–ç”¨æˆ·å¤´åƒæ˜µç§°
### ç›®æ ‡
ç†Ÿæ‚‰buttonç»„ä»¶å¸¸ç”¨çš„open-typeç±»å‹åŠä¸€äº›å¸¸ç”¨å¸ƒå±€æŠ€å·§
### ä»£ç å‚è€ƒ
```vue
<template>
  <view>
    <!-- ç”¨æˆ·ä¿¡æ¯ -->
    <view class="userinfo">
      <template v-if="true">
        <!-- å¤´åƒæ¨¡ç³ŠèƒŒæ™¯ -->
        <image class="avatar-bg" :src="defaultSrc" mode="aspectFill" />
        <!-- å¤´åƒ -->
        <view class="avatar">
          <image
            class="img-avatar"
            :src="defaultSrc"
            mode="aspectFill"
          />
          <button
            class="btn-avatar"
            @chooseavatar="chooseAvatar"
            open-type="chooseAvatar"
          >
            è·å–å¤´åƒ
          </button>
        </view>

        <!-- æ˜µç§° -->
        <input :value="'ç”¨æˆ·æ˜µç§°'" @blur="getNickName" class="nickname" type="nickname" />
      </template>
      <template v-else>
        <button type="primary">ç”¨æˆ·ç™»å½•</button>
      </template>
    </view>
    <!-- è®¢å•å¯¼èˆª -->
    <view class="nav">
      <view class="nav-item" v-for="item in nav" :key="item.type">
        <u-icon size="50rpx" :name="item.icon"></u-icon>
        <text class="nav-text">{{ item.title }}</text>
      </view>
    </view>
    <!-- å•å…ƒæ ¼ -->
    <view class="cell">
      <u-cell-group :border="false">
        <u-cell icon="kefu-ermai" value="10086">
          <view class="cell-title" slot="title">
            è”ç³»å®¢æœ
            <button class="cell-button" open-type="contact">å®¢æœæŒ‰é’®</button>
          </view>
        </u-cell>
        <u-cell icon="edit-pen">
          <view class="cell-title" slot="title">
            æ„è§åé¦ˆ
            <button class="cell-button" open-type="feedback">åé¦ˆæŒ‰é’®</button>
          </view>
        </u-cell>
        <u-cell icon="setting">
          <view class="cell-title" slot="title">
            ç³»ç»Ÿè®¾ç½®
            <button class="cell-button" open-type="openSetting">è®¾ç½®</button>
          </view>
        </u-cell>
        <u-cell icon="info-circle" value="v1.0.0">
          <view class="cell-title" slot="title">å½“å‰ç‰ˆæœ¬</view>
        </u-cell>
      </u-cell-group>
      <button type="warn" plain>é€€å‡ºç™»å½•</button>
    </view>
  </view>
</template>

<script>
export default {
  data() {
    return {
      avatarUrl: '',
      nickName: '',
      // é»˜è®¤å›¾ç‰‡åœ°å€
      defaultSrc:
        "https://img0.baidu.com/it/u=324754129,1809452373&fm=253&fmt=auto&app=138&f=JPEG?w=529&h=500",
      nav: [
        { type: 1, icon: "order", title: "å…¨éƒ¨è®¢å•" },
        { type: 2, icon: "rmb-circle", title: "å¾…ä»˜æ¬¾" },
        { type: 3, icon: "car", title: "å¾…æ”¶è´§" },
        { type: 4, icon: "reload", title: "é€€è´§/é€€æ¬¾" },
      ]
    };
  },
};
</script>

<style lang="scss">
// é¡µé¢èƒŒæ™¯
page {
  background-color: #f9f9f9;
}
// ç”¨æˆ·ä¿¡æ¯
.userinfo {
  height: 330rpx;
  position: relative;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  .avatar-bg {
    z-index: -1;
    width: 120%;
    height: 120%;
    position: absolute;
    // æ»¤é•œ: æ¨¡ç³Š
    filter: blur(30rpx);
    left: -10%;
    top: -10%;
  }
  .avatar {
    position: relative;
    border-radius: 50%;
    width: 172rpx;
    height: 172rpx;
    .img-avatar {
      width: 100%;
      height: 100%;
      border-radius: 50%;
    }
    .btn-avatar {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      opacity: 0;
    }
  }
  .nickname {
    color: #fff;
    margin-top: 20rpx;
    text-shadow: 2rpx 2rpx 10rpx #333;
    text-align: center;
  }
}

// å¯¼èˆªåˆ—è¡¨
.nav {
  margin: 20rpx;
  background-color: #fff;
  border-radius: 15rpx;
  height: 144rpx;
  display: flex;
  justify-content: space-around;
  .nav-item {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    .nav-text {
      font-size: 26rpx;
      margin-top: 16rpx;
      color: #474747;
    }
  }
}

// å•å…ƒæ ¼
.cell {
  margin: 20rpx;
  background-color: #fff;
  border-radius: 15rpx;
  height: 520rpx;
  .cell-title {
    position: relative;
    .cell-button {
      // é€æ˜åº¦ä¸º 0
      opacity: 0;
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
    }
  }
}
</style>
```



### jsé€»è¾‘å®Œå–„

```vue
<template v-if="true">
        <!-- å¤´åƒæ¨¡ç³ŠèƒŒæ™¯ -->
  <image class="avatar-bg" :src="avatarUrl || defaultSrc" mode="aspectFill" />
  <!-- å¤´åƒ -->
  <view class="avatar">
    <image
           class="img-avatar"
           :src="avatarUrl || defaultSrc"
           mode="aspectFill"
           />
    <button
            class="btn-avatar"
            v-if="!avatarUrl"
            open-type="chooseAvatar"
            @chooseavatar="chooseAvatar"
            >
      è·å–å¤´åƒ
    </button>
  </view>

  <!-- æ˜µç§° -->
  	<input
         :value="nickName || 'å¾®ä¿¡ç”¨æˆ·'"
         @blur="getNickName"
         class="nickname"
         type="nickname"
         />
</template>

<script>
	export default {
    data() {
      return {
        avatarUrl: '',
        nickName: '',
        defaultSrc: 'https://img0.baidu.com/it/u=324754129,1809452373&fm=253&fmt=auto&app=138&f=JPEG?w=529&h=500'
      }
    },
    methods: {
       chooseAvatar(res) {
          // console.log(res);
          this.avatarUrl = res.detail.avatarUrl;
        },
        getNickName(event) {
          this.nickName = event.detail.value;
        },
    }
  }
</script>
```

## 06.vuexâ€”å‘½åç©ºé—´æ¨¡å—
### ç›®æ ‡
æŒæ¡vuexä¸­æ¨¡å—çš„ä½¿ç”¨
### vuexä¸­çš„æ¨¡å—
```javascript
const moduleA = {
  state: () => ({ ... }),
  mutations: { ... },
  actions: { ... },
  getters: { ... }
}

const moduleB = {
  state: () => ({ ... }),
  mutations: { ... },
  actions: { ... }
}

const store = createStore({
  modules: {
    a: moduleA,
    b: moduleB
  }
})

store.state.a // -> moduleA çš„çŠ¶æ€
store.state.b // -> moduleB çš„çŠ¶æ€
```
### å‘½åç©ºé—´æ¨¡å—
é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡å—å†…éƒ¨çš„ action å’Œ mutation ä»ç„¶æ˜¯æ³¨å†Œåœ¨**å…¨å±€å‘½åç©ºé—´**çš„â€”â€”è¿™æ ·ä½¿å¾—å¤šä¸ªæ¨¡å—èƒ½å¤Ÿå¯¹åŒä¸€ä¸ª action æˆ– mutation ä½œå‡ºå“åº”ã€‚Getter åŒæ ·ä¹Ÿé»˜è®¤æ³¨å†Œåœ¨å…¨å±€å‘½åç©ºé—´ï¼Œä½†æ˜¯ç›®å‰è¿™å¹¶éå‡ºäºåŠŸèƒ½ä¸Šçš„ç›®çš„ï¼ˆä»…ä»…æ˜¯ç»´æŒç°çŠ¶æ¥é¿å…éå…¼å®¹æ€§å˜æ›´ï¼‰ã€‚å¿…é¡»æ³¨æ„ï¼Œä¸è¦åœ¨ä¸åŒçš„ã€æ— å‘½åç©ºé—´çš„æ¨¡å—ä¸­å®šä¹‰ä¸¤ä¸ªç›¸åŒçš„ getter ä»è€Œå¯¼è‡´é”™è¯¯ã€‚<br />å¦‚æœå¸Œæœ›ä½ çš„æ¨¡å—å…·æœ‰æ›´é«˜çš„å°è£…åº¦å’Œå¤ç”¨æ€§ï¼Œä½ å¯ä»¥é€šè¿‡æ·»åŠ  `namespaced: true` çš„æ–¹å¼ä½¿å…¶æˆä¸ºå¸¦å‘½åç©ºé—´çš„æ¨¡å—ã€‚å½“æ¨¡å—è¢«æ³¨å†Œåï¼Œå®ƒçš„æ‰€æœ‰ getterã€action åŠ mutation éƒ½ä¼šè‡ªåŠ¨æ ¹æ®æ¨¡å—æ³¨å†Œçš„è·¯å¾„è°ƒæ•´å‘½å
```javascript
const store = createStore({
  modules: {
    account: {
      namespaced: true,

      // æ¨¡å—å†…å®¹ï¼ˆmodule assetsï¼‰
      state: () => ({ ... }), // æ¨¡å—å†…çš„çŠ¶æ€å·²ç»æ˜¯åµŒå¥—çš„äº†ï¼Œä½¿ç”¨ `namespaced` å±æ€§ä¸ä¼šå¯¹å…¶äº§ç”Ÿå½±å“
      getters: {
        isAdmin () { ... } // -> getters['account/isAdmin']
      },
      actions: {
        login () { ... } // -> dispatch('account/login')
      },
      mutations: {
        login () { ... } // -> commit('account/login')
      },
   }
 }
});
```
å‚è€ƒæ–‡æ¡£ï¼š[https://vuex.vuejs.org/zh/guide/modules.html](https://vuex.vuejs.org/zh/guide/modules.html)

### æ ¸å¿ƒæ­¥éª¤
æ–°å¢ä¸€ä¸ªvuexçš„æ¨¡å— `user.js`

1. åœ¨storeæ–‡ä»¶å¤¹ä¸‹æ–°å¢user.jsæ–‡ä»¶
2. åœ¨store/index.jsæ–‡ä»¶ä¸­å¯¼å…¥userï¼Œå¹¶å°†å…¶æ”¾å…¥moduleså±æ€§ä¸­
### å‚è€ƒä»£ç 
```javascript
export default {
  namespaced: true,
  state: {
  },
  mutations: {
  }
}

//åœ¨index.jsé‡Œé¢

import user from './modules/user'
// åŠ ä¸€ä¸ªå±æ€§
modules: {
  user,
},
    
// é¡µé¢ä¸Šä½¿ç”¨çš„æ—¶å€™
this.$store.commit('user/xxxxmutation', å‚æ•°)

// è®¡ç®—å±æ€§è·å–æ•°æ®æµ‹è¯•
    computed:{
        myname(){
            return this.$store.state.user.myname
        }
    }
```

## 07.ä¸ªäººä¸­å¿ƒâ€”å°ç¨‹åºç™»å½•æµç¨‹
### ç›®æ ‡
äº†è§£å°ç¨‹åºç™»å½•æµç¨‹
### ç™»å½•æµç¨‹æ—¶åºå›¾
![image.png](https://cdn.nlark.com/yuque/0/2023/png/32808751/1677207331516-ef95e811-e7b4-4818-be99-d5f947c85468.png#averageHue=%23f7f7f7&clientId=ucccbfdbf-ffc5-4&from=paste&height=757&id=u4db8dc0f&name=image.png&originHeight=1514&originWidth=1510&originalType=binary&ratio=2&rotation=0&showTitle=false&size=382721&status=done&style=none&taskId=u376d8b22-6388-4539-a334-2d2cde18aa5&title=&width=755)

**openid**: ç”¨æˆ·å”¯ä¸€æ ‡è¯†<br />**session_key**: æ˜¯å¯¹ç”¨æˆ·æ•°æ®è¿›è¡Œ [åŠ å¯†ç­¾å](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html) çš„å¯†é’¥ã€‚ä¸ºäº†åº”ç”¨è‡ªèº«çš„æ•°æ®å®‰å…¨ï¼Œå¼€å‘è€…æœåŠ¡å™¨**ä¸åº”è¯¥æŠŠä¼šè¯å¯†é’¥ä¸‹å‘åˆ°å°ç¨‹åºï¼Œä¹Ÿä¸åº”è¯¥å¯¹å¤–æä¾›è¿™ä¸ªå¯†é’¥**

## 08.ä¸ªäººä¸­å¿ƒâ€”å°ç¨‹åºç™»å½•å®ç°
### ç›®æ ‡
æŒæ¡å°ç¨‹åºçš„ç™»å½•å®ç°
### æ ¸å¿ƒæ­¥éª¤

1. è°ƒç”¨uni.getUserInfoè·å–åŠ å¯†çš„ç”¨æˆ·ä¿¡æ¯
2. è°ƒç”¨uni.loginè·å–codeç 
3. æ ¹æ®ä»¥ä¸Šä¸¤ä¸ªapiçš„è¿”å›ä½œä¸ºå‚æ•°å‘é€è¯·æ±‚
```javascript
   // ç”¨æˆ·ç™»å½•
    async wxLogin() {
      // è·å–ç”¨æˆ·ä¿¡æ¯
      const [error, res] = await uni.getUserInfo();
      // const res2 = await wx.getUserProfile({ desc: 'è·å–ç”¨æˆ·ä¿¡æ¯ç”¨äºç™»å½•' });
      // ä½¿ç”¨ä¸Šé¢çš„apiä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œç‰ˆæœ¬å·è¦åœ¨ 2.27.1ä»¥ä¸‹
      // console.log(res);
      // è§£æ„res
      const { encryptedData, iv, rawData, signature } = res;

      // è·å–codeç 
      const [error1, { code }] = await uni.login();
      console.log(code);

      // å®šä¹‰è¯·æ±‚å‚æ•°
      const data = {
        code,
				encryptedData,
				iv,
				rawData,
				signature
      };

      // å‘é€è¯·æ±‚
      const resData = await uni.$u.http.post("/users/wxlogin", data);
			console.log(resData);
    },
```
:::success
æ³¨æ„ï¼š/users/wxloginæ¥å£ä¸­ä¼ å…¥çš„codeå¿…é¡»æ˜¯**é»‘é©¬ä¼˜è´­**çš„**appId**å¯¹åº”çš„codeï¼Œå¦åˆ™ä¼šæç¤ºæ— æ•ˆ
:::



### æ€»ç»“ï¼š

1. å°ç¨‹åºç™»å½•çš„åŸºæœ¬æµç¨‹ï¼Œè¦ä½¿ç”¨å“ªä¸¤ä¸ªåŸç”Ÿapiå‡½æ•°



## 09.ä¸ªäººä¸­å¿ƒâ€”ä¿å­˜tokenåˆ°vuex
### ç›®æ ‡
æŒæ¡vuexä¸­modulesåŠactionsçš„ä½¿ç”¨
### å‚è€ƒä»£ç 
```javascript
export default {
  namespaced: true,
  state: {
    token: uni.getStorageSync('token') || ''
  },
  getters: {},
  mutations: {
    // æ›´æ–°tokençš„mutation
    updateToken(state, token) {
      state.token = token;
      // æœ¬åœ°æŒä¹…åŒ–
      uni.setStorageSync('token', token);
    }
  },
}

// é¡µé¢é‡Œé¢ä½¿ç”¨
this.$store.commit('user/updateToken', resData.data.message.token);
```
## 10.ä¸ªäººä¸­å¿ƒâ€”è¯·æ±‚æ‹¦æˆªå™¨æ·»åŠ token
### ç›®æ ‡
æŒæ¡è¯·æ±‚æ‹¦æˆªå™¨æ·»åŠ tokençš„å®ç°
### æ ¸å¿ƒæ­¥éª¤

1. è·å–token
2. åˆ¤æ–­è¯·æ±‚è·¯å¾„æ˜¯å¦ä»¥`/my/`å¼€å¤´ 
   - æ˜¯ï¼Œåœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ token
   - ä¸æ˜¯ï¼Œä¸åŠ 
```javascript
// è®¾ç½®è¯·æ±‚æ‹¦æˆªå™¨
uni.$u.http.interceptors.request.use((config) => { // å¯ä½¿ç”¨async await åšå¼‚æ­¥æ“ä½œ
  uni.showLoading();
  // è·å–token
  const token = store.state.user.token;
  // è®¾ç½®è¯·æ±‚å¤´token
  if (token && config.url.startsWith('/my/')) {
    config.header.Authorization = token
  }
  return config
}, config => { // å¯ä½¿ç”¨async await åšå¼‚æ­¥æ“ä½œ
  return Promise.reject(config)
})
```
## 11.è®¢å•æ”¯ä»˜
### ç›®æ ‡
æŒæ¡è®¢å•æ”¯ä»˜æµç¨‹
### è®¢å•æ”¯ä»˜æµç¨‹
![image.png](https://cdn.nlark.com/yuque/0/2023/png/32808751/1677207701114-ded9b579-9237-4248-8e85-d949cb9c88b3.png#averageHue=%23fefefc&clientId=ucccbfdbf-ffc5-4&from=paste&height=353&id=u4030dba3&name=image.png&originHeight=706&originWidth=832&originalType=binary&ratio=2&rotation=0&showTitle=false&size=120974&status=done&style=none&taskId=u473a4ae1-75fe-4d73-a124-60aeefe63a1&title=&width=416)
### æ ¸å¿ƒæ­¥éª¤

1.  ç»™å»æ”¯ä»˜ç»‘å®šäº‹ä»¶ 
2.  åˆ¤æ–­æ˜¯å¦å·²ç»æœ‰æ”¶è·åœ°å€ 
   - æœ‰ï¼Œç»§ç»­
   - æ²¡æœ‰ï¼Œreturnå¹¶æç¤º
3.  åˆ›å»ºè®¢å•è·å–è®¢å•ç¼–å· 
4.  æ ¹æ®è®¢å•ç¼–å·åˆ›å»ºæ”¯ä»˜æµç¨‹è·å–æ”¯ä»˜å‚æ•° 
5.  æ ¹æ®æ”¯ä»˜å‚æ•°è°ƒç”¨å¾®ä¿¡æ”¯ä»˜api Â wx.requestPaymentå‘èµ·æ”¯ä»˜ 

```javascript
 // å»æ”¯ä»˜
    async gotoPay() {
      if (!this.addressDetail.trim()) {
        return uni.showToast({
          icon: 'none',
          title: 'è¯·å¡«å†™è¯¦ç»†åœ°å€~'
        });
      }
      // è·å–è®¢å•ç¼–å·
      // å®šä¹‰è¯·æ±‚å‚æ•°
      const data = {
        order_price: this.selectedCartListPrice,
        consignee_addr: this.detailAddress,
        goods: this.selectedCartList.map((v) => {
          return {
            goods_id: v.goods_id,
            goods_number: v.goods_count,
            goods_price: v.goods_price,
          };
        }),
      };
      // console.log(data);
      const res = await uni.$u.http.post("/my/orders/create", data);
      // console.log(res);
      // è·å–è®¢å•ç¼–å·
      const { order_number } = res.data.message;

      // è·å–æ”¯ä»˜å‚æ•°
      const res1 = await uni.$u.http.post('/my/orders/req_unifiedorder', {
        order_number
      });
      // console.log(res1);
      // è·å–æ”¯ä»˜å‚æ•°
      const { pay } = res1.data.message;
      // console.log(pay);
      
      // è°ƒapi å‘èµ·æ”¯ä»˜
      uni.requestPayment(pay);
  },
```
:::success
**æ³¨æ„ï¼š**ä¸ªäººå°ç¨‹åºæ— æ³•è°ƒç”¨æ”¯ä»˜apiã€‚--------   wxfb52f2d7b2f6123a
:::

## 12.å¤šç«¯ç¼–è¯‘â€”ç¼–è¯‘æˆä¸åŒå¹³å°ä»£ç 
### ç›®æ ‡
äº†è§£uni-appå¦‚ä½•ä¸€å¥—ä»£ç ç¼–è¯‘æˆå¤šä¸ªå¹³å°ä»£ç 
### ç¼–è¯‘çš„é˜¶æ®µ

- å¼€å‘é˜¶æ®µ 
   - npm run dev:å¹³å°ä»£å·
- å‘å¸ƒé˜¶æ®µ 
   - npm run build: å¹³å°ä»£å·

![image.png](https://cdn.nlark.com/yuque/0/2023/png/32808751/1677207763950-99d35164-d1bc-47e8-8ff7-5918d323ab10.png#averageHue=%23e39d9c&clientId=ucccbfdbf-ffc5-4&from=paste&height=469&id=u6b59c775&name=image.png&originHeight=938&originWidth=1272&originalType=binary&ratio=2&rotation=0&showTitle=false&size=423572&status=done&style=none&taskId=ua8cd8d7a-bed5-4094-afd2-3e1a7fb8011&title=&width=636)
## 13.å¤šç«¯ç¼–è¯‘â€”æ¡ä»¶ç¼–è¯‘æ³¨é‡Š
### ç›®æ ‡
æŒæ¡æ¡ä»¶ç¼–è¯‘å®ç°æ–¹å¼
### ç®€ä»‹

-  æ¡ä»¶ç¼–è¯‘æ˜¯uniappä¸­çš„ä¸€ç§æ ¹æ®ç‰¹æ®Šçš„æ³¨é‡Šæ¥å®ç°**ä¸åŒå¹³å°ä¸‹**è¿è¡Œ**ä¸åŒä»£ç **çš„åŠŸèƒ½çš„æŠ€æœ¯ã€‚ 
-  æ¡ä»¶ç¼–è¯‘æ”¯æŒçš„æ–‡ä»¶æœ‰ vueã€jsã€.jsonã€scssã€lessã€stylusã€ts 
-  æ¡ä»¶ç¼–è¯‘çš„è¯­æ³•æ˜¯ 
   - #ifdefï¼šif defined ä»…åœ¨æŸå¹³å°å­˜åœ¨
   - #ifndefï¼šif not defined é™¤äº†æŸå¹³å°å‡å­˜åœ¨

![image.png](https://cdn.nlark.com/yuque/0/2023/png/32808751/1677207817467-1e5d90a4-c525-4178-8e60-bf98683d18a6.png#averageHue=%23f6f7ed&clientId=ucccbfdbf-ffc5-4&from=paste&height=301&id=u69f099b9&name=image.png&originHeight=602&originWidth=1852&originalType=binary&ratio=2&rotation=0&showTitle=false&size=415338&status=done&style=none&taskId=u34f00c69-a81b-4677-a4c6-4295df00e87&title=&width=926)

-  éœ€è¦æ³¨æ„çš„æ˜¯ä¸åŒçš„æ–‡ä»¶ã€æ³¨é‡Šçš„ç¬¦å·æ—¶ä¸ä¸€æ ·çš„ 

![image.png](https://cdn.nlark.com/yuque/0/2023/png/32808751/1677207846016-2dbc0e53-5b80-4794-9f94-4b3a48027e56.png#averageHue=%2390918d&clientId=ucccbfdbf-ffc5-4&from=paste&height=327&id=ud6856454&name=image.png&originHeight=654&originWidth=1816&originalType=binary&ratio=2&rotation=0&showTitle=false&size=232341&status=done&style=none&taskId=u6fa809a9-fdc9-4197-8ed6-e83a93be024&title=&width=908)

```vue
onLoad() {
  // è„šæœ¬æ¡ä»¶ç¼–è¯‘
  /* #ifdef MP-WEIXIN */
  console.log('ğŸ¯MP-WEIXINç«¯è¿è¡Œ~')
  /* #endif */

  /* #ifdef H5 */
  console.log('ğŸŸ H5ç«¯è¿è¡Œ~')
  /* #endif */
},
```



### æ€»ç»“ï¼š

ä»€ä¹ˆæ˜¯æ¡ä»¶ç¼–è¯‘ï¼Ÿ



## 14.å¤šç«¯ç¼–è¯‘â€”å°ç¨‹åºä¸H5çš„è§†å£å·®å¼‚

### ç›®æ ‡
äº†è§£å°ç¨‹åºä¸h5çš„è§†å£å·®å¼‚å¹¶èƒ½ä½¿ç”¨æ¡ä»¶ç¼–è¯‘è§£å†³
### ç°è±¡
![image.png](https://cdn.nlark.com/yuque/0/2023/png/32808751/1677207920202-708a9a60-abc9-4367-bf7b-d87fa3fc8bce.png#averageHue=%23e8e8e7&clientId=ucccbfdbf-ffc5-4&from=paste&height=142&id=ubb67f2a1&name=image.png&originHeight=284&originWidth=1852&originalType=binary&ratio=2&rotation=0&showTitle=false&size=237953&status=done&style=none&taskId=uca1630c0-e903-4aec-bd32-dd896352fa4&title=&width=926)
### åŸå› 
å°ç¨‹åºçš„è§†å£æ˜¯ä¸åŒ…å«é¡¶éƒ¨å¯¼èˆªæ å’Œåº•éƒ¨tabBaré«˜åº¦çš„ï¼Œè€ŒH5æ˜¯å±å¹•çš„é«˜åº¦ã€‚
### å‚è€ƒä»£ç 
```css
// å®šä½çš„æ“ä½œæ 
  .bottom-bar-fixed {
    ...
    bottom: 0;

    /* #ifdef H5 */
    bottom: 50px;
    /* #endif */
    
    ...
 }
```
## 
## 15.å¤šç«¯ç¼–è¯‘â€”å¯¼èˆªæ ä¸tabBaré«˜åº¦å˜é‡
### ç›®æ ‡
æŒæ¡csså˜é‡ä½¿ç”¨æ–¹å¼åŠuni-appä¸­å¯¼èˆªæ ä¸tabBaré«˜åº¦å˜é‡ã€‚
### uni-appæ–°å¢çš„2ä¸ªcsså˜é‡ï¼š

-  `--window-top` Â  Â  Â  Â  Â  Â  Â  Â  Â é¡¶éƒ¨å¯¼èˆªçš„é«˜åº¦ 
-  `--window-bottom` Â  Â  Â  Â  Â  åº•éƒ¨tabBarçš„é«˜åº¦ 
### å‚è€ƒä»£ç 
```css

.m-category {
  display: flex;
  width: 100vw;
  height: calc(100vh - 20rpx - 34px - var(--window-top) - var(--window-bottom));
}
```


### é¢è¯•é¢˜

**ioså¼€å‘çš„è®¾ç½®é—®é¢˜-- å®‰å…¨åŒºåŸŸ**

https://juejin.cn/post/6844903974491930637



## 16.å¾®ä¿¡å°ç¨‹åºâ€”ä¸Šçº¿æµç¨‹

### ç›®æ ‡
æŒæ¡uni-appå¼€å‘å°ç¨‹åºçš„ä¸Šçº¿æµç¨‹
### æ ¸å¿ƒæ­¥éª¤

1. ä½¿ç”¨uniapp æ„å»ºæ‰“åŒ…é¡¹ç›®
2. åœ¨å°ç¨‹åºå·¥å…·ä¸­å¯¼å…¥è¦å‘å¸ƒçš„é¡¹ç›®ï¼ˆå¤§å°ä¸èƒ½è¶…è¿‡2Mï¼‰
3. åœ¨å°ç¨‹åºå·¥å…·ä¸­ç‚¹å‡» â€œä¸Šä¼ â€
4. å›åˆ°å¾®ä¿¡å…¬ä¼—å¹³å°ä¸Šæ‰‹åŠ¨ç‚¹å‡»æäº¤å®¡æ ¸å’Œä¸Šçº¿
## 17.å¾®ä¿¡å°ç¨‹åºâ€”å¼€æºé¡¹ç›®æŸ¥æ‰¾
giteeåœ°å€ï¼š[https://gitee.com/explore/weixin-lapp](https://gitee.com/explore/weixin-lapp)

